<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Select Date & Image</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

<style>
    body {
        font-family: 'Poppins', sans-serif;
        background: #f4f6f9;
        margin: 0;
        padding: 40px;
        display: flex;
        justify-content: center;
    }

    .container { width: 600px; }

    .section {
        background: #ffffff;
        padding: 28px;
        margin-bottom: 25px;
        border-radius: 14px;
        box-shadow: 0 6px 18px rgba(0,0,0,0.06);
    }

    h2 {
        margin: 0 0 6px;
        font-weight: 600;
        font-size: 20px;
    }

    .subheading {
        color: #777;
        font-size: 14px;
        margin-bottom: 22px;
    }

    .dates {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
    }

    .date-option {
        flex: 1;
        padding: 16px;
        text-align: center;
        border: 2px solid #e0e0e0;
        border-radius: 10px;
        cursor: pointer;
        transition: all 0.25s ease;
        font-weight: 500;
        font-size: 14px;
        min-width: 120px;
    }

    .date-option.selected {
        border-color: #4CAF50;
        background: #e8f5e9;
        color: #2e7d32;
    }

    .date-option:hover {
        border-color: #4CAF50;
    }

    .upload-btn {
        display: inline-block;
        padding: 10px 22px;
        background: #4CAF50;
        color: white;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
    }

    .upload-btn:hover { background: #43a047; }

    #imagePreview {
        margin-top: 20px;
        max-width: 100%;
        border-radius: 12px;
        display: none;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    input[type="file"] { display: none; }

    .center {
        text-align: center;
        padding: 30px 0;
    }

    .retry-btn {
        margin-top: 15px;
        padding: 10px 20px;
        background: #ff5252;
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
    }

    .retry-btn:hover {
        background: #e53935;
    }

    @media (max-width: 640px) {
        .container { width: 100%; }
        .dates { flex-direction: column; }
    }
    /* Floating Continue Button */
.floating-continue {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    width: 90%;
    max-width: 600px;
    padding: 16px;
    border-radius: 12px;
    border: none;
    font-size: 16px;
    font-weight: 600;
    cursor: not-allowed;
    background: #cfcfcf;
    color: #ffffff;
    box-shadow: 0 6px 18px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
    z-index: 1000;
}

.floating-continue.enabled {
    background: linear-gradient(135deg, #4CAF50, #43a047);
    cursor: pointer;
    box-shadow: 0 8px 22px rgba(76, 175, 80, 0.4);
}

.floating-continue.enabled:hover {
    transform: translateX(-50%) scale(1.02);
}
</style>
</head>

<body>

<div class="container">

    <!-- Date Section -->
    <div class="section" id="dateSection">
        <h2 id="heading">Loading...</h2>
        <div class="subheading" id="subheading">Please wait while we fetch available dates</div>
        <div class="dates" id="datesContainer"></div>
        <div class="center" id="errorContainer" style="display:none;"></div>
    </div>

    <!-- Image Section -->
    <div class="section">
        <h2>Select an Image</h2>
        <div class="subheading">Add an apt image</div>

     <div style="display:flex; gap:15px; flex-wrap:wrap;">

    <!-- Camera Button -->
    <label class="upload-btn">
        üì∑ Take Photo
        <input type="file" id="cameraUpload" accept="image/*" capture="environment">
    </label>

    <!-- Gallery Button -->
    <label class="upload-btn" style="background:#2196F3;">
        üñº Choose from Gallery
        <input type="file" id="galleryUpload" accept="image/*">
    </label>

</div>


        <img id="imagePreview" />
    </div>
<button id="continueBtn" class="floating-continue" disabled>
    Continue
</button>
</div>

<script>
const API_URL = "https://0gb8de1kda.execute-api.us-east-1.amazonaws.com/2order/2order/dateandaddress";

const heading = document.getElementById("heading");
const subheading = document.getElementById("subheading");
const datesContainer = document.getElementById("datesContainer");
const errorContainer = document.getElementById("errorContainer");

async function fetchDates() {
    // Show loading state
    heading.textContent = "Loading...";
    subheading.textContent = "Please wait while we fetch available dates";
    datesContainer.innerHTML = "";
    errorContainer.style.display = "none";

    try {
         const response = await fetch(API_URL, {
            method: "GET",
            headers: {
                "Content-Type": "application/json"
            }
        });

        if (!response.ok) throw new Error("Network error");

        const data = await response.json();

        // Success UI
        heading.textContent = data.message || "Select a Date";
        subheading.textContent = "This is the closest date available";

        renderDates(data.dates);

    } catch (error) {
        showError();
    }
}

function renderDates(dates) {
    datesContainer.innerHTML = "";

    dates.forEach((date, index) => {
        const div = document.createElement("div");
        div.className = "date-option";
        div.textContent = date;

        if (index === 0) div.classList.add("selected");

        div.addEventListener("click", () => {
            document.querySelectorAll(".date-option")
                .forEach(d => d.classList.remove("selected"));
            div.classList.add("selected");
        });

        datesContainer.appendChild(div);
    });
}

function showError() {
    heading.textContent = "OOps";
    subheading.textContent = "Something went wrong";

    errorContainer.style.display = "block";
    errorContainer.innerHTML = `
        <button class="retry-btn" onclick="fetchDates()">Retry</button>
    `;
}

// Call on page load
fetchDates();

// Image preview logicconst cameraUpload = document.getElementById('cameraUpload');
const galleryUpload = document.getElementById('galleryUpload');
const imagePreview = document.getElementById('imagePreview');

function handleImageUpload(input) {
    if (!input.files || input.files.length === 0) return;

    const file = input.files[0];

    if (!file.type.startsWith("image/")) {
        alert("Please select a valid image");
        return;
    }

    const reader = new FileReader();
    reader.onload = function (e) {
        imagePreview.src = e.target.result;
        imagePreview.style.display = 'block';
    };

    reader.readAsDataURL(file);
}

cameraUpload.addEventListener('change', function() {
    handleImageUpload(this);
});

galleryUpload.addEventListener('change', function() {
    handleImageUpload(this);
});

const continueBtn = document.getElementById('continueBtn');

function handleImageUpload(input) {
    if (!input.files || input.files.length === 0) return;

    const file = input.files[0];

    if (!file.type.startsWith("image/")) {
        alert("Please select a valid image");
        return;
    }

    const reader = new FileReader();
    reader.onload = function (e) {
        imagePreview.src = e.target.result;
        imagePreview.style.display = 'block';

        // ‚úÖ Enable Continue button
        continueBtn.disabled = false;
        continueBtn.classList.add("enabled");
    };

    reader.readAsDataURL(file);
}





continueBtn.addEventListener("click", function () {

    /* ------------------ 1Ô∏è‚É£ Get Selected Date ------------------ */
    const selectedDateEl = document.querySelector(".date-option.selected");

    if (!selectedDateEl) {
        alert("Please select a date");
        return;
    }

    const selectedDate = selectedDateEl.textContent;

    /* ------------------ 2Ô∏è‚É£ Get Image (Base64) ------------------ */
    const imageData = imagePreview.src;

    if (!imageData) {
        alert("Please upload an image");
        return;
    }

    /* ------------------ 3Ô∏è‚É£ Convert to Pure Base64 ------------------ */
    // Remove data URL prefix (if present) to match Flutter base64Encode style
    const pureBase64 = imageData.includes(",") ? imageData.split(",")[1] : imageData;

    /* ------------------ 4Ô∏è‚É£ Save to localStorage ------------------ */
    localStorage.setItem("selectedDate", selectedDate);
    localStorage.setItem("selectedImage", pureBase64);

    console.log("Date Saved:", selectedDate);
    console.log("Image Saved (Base64):", pureBase64);

    /* ------------------ 5Ô∏è‚É£ Navigate to Next Page ------------------ */
    window.location.href = "Address.html";
});



// continueBtn.addEventListener("click", function () {

//     // 1Ô∏è‚É£ Get selected date
//     const selectedDateEl = document.querySelector(".date-option.selected");

//     if (!selectedDateEl) {
//         alert("Please select a date");
//         return;
//     }

//     const selectedDate = selectedDateEl.textContent;

//     // 2Ô∏è‚É£ Get image (base64)
//     const imageData = imagePreview.src;

//     if (!imageData) {
//         alert("Please upload an image");
//         return;
//     }

//     // ‚úÖ Save separately
//     localStorage.setItem("selectedDate", selectedDate);
//     localStorage.setItem("selectedImage", imageData);

//     console.log("Date Saved:", selectedDate);
//     console.log("Image Saved:", imageData);
//      window.location.href = "Address.html";

// });

</script>

</body>
</html>
